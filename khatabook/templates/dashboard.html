<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Business KhataBook</title>

    <!-- MOBILE RESPONSIVE -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#0d6efd">

    <!-- APP ICON -->
    <link rel="icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">

    <!-- BOOTSTRAP 5 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">

<div class="container mt-4 mb-5">

    <!-- HEADER WITH LOGO -->
    <h2 class="text-center mb-4 d-flex justify-content-center align-items-center gap-2">
        <img src="{{ url_for('static', filename='logo.png') }}" height="40" alt="Logo">
        Business KhataBook
    </h2>

    <!-- SUMMARY CARDS -->
    <div class="row g-3 mb-4 text-center">
        <div class="col-md-4 col-12">
            <div class="card text-bg-success shadow-sm">
                <div class="card-body">
                    <h6>Total IN</h6>
                    <h3>‚Çπ {{ total_in }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-12">
            <div class="card text-bg-danger shadow-sm">
                <div class="card-body">
                    <h6>Total OUT</h6>
                    <h3>‚Çπ {{ total_out }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-12">
            <div class="card text-bg-primary shadow-sm">
                <div class="card-body">
                    <h6>Balance</h6>
                    <h3>‚Çπ {{ balance }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- FILTER & PDF -->
    <div class="card p-3 mb-4 shadow-sm">
        <form method="get" class="row g-3 align-items-end">

            <div class="col-md-3 col-12">
                <label class="form-label">From Date</label>
                <input type="date" name="from_date" class="form-control" value="{{ from_date }}">
            </div>

            <div class="col-md-3 col-12">
                <label class="form-label">To Date</label>
                <input type="date" name="to_date" class="form-control" value="{{ to_date }}">
            </div>

            <div class="col-md-3 col-12">
                <button type="submit" class="btn btn-dark w-100">
                    üîç Apply Filter
                </button>
            </div>

            <div class="col-md-3 col-12">
                <a href="/download-pdf" class="btn btn-outline-primary w-100">
                    üìÑ Download All Entries PDF
                </a>
            </div>

        </form>
    </div>

    <!-- ADD ENTRY -->
    <form method="post" class="card p-3 mb-4 shadow-sm">
        <div class="row g-3">

            <div class="col-md-3 col-12">
                <label class="form-label">Date</label>
                <input type="date" name="date" class="form-control" value="{{ today }}">
            </div>

            <div class="col-md-4 col-12">
                <label class="form-label">Person Name</label>
                <input type="text" name="person" class="form-control" required>
            </div>

            <div class="col-md-2 col-6">
                <label class="form-label">Amount</label>
                <input type="number" name="amount" class="form-control" min="1" required>
            </div>

            <div class="col-md-2 col-6">
                <label class="form-label">Type</label>
                <select name="type" class="form-select">
                    <option value="IN">IN</option>
                    <option value="OUT">OUT</option>
                </select>
            </div>

            <div class="col-md-1 col-12 d-grid">
                <button class="btn btn-success">Add</button>
            </div>

        </div>
    </form>

    <!-- TABLE -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Date</th>
                    <th>Person</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th class="text-center">Action</th>
                </tr>
            </thead>

            <tbody>
            {% for e in entries %}
                <tr>
                    <td>{{ e.date }}</td>
                    <td>{{ e.person }}</td>
                    <td>‚Çπ {{ e.amount }}</td>
                    <td>{{ e.type }}</td>
                    <td class="text-center">
                        <button class="btn btn-outline-danger btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal{{ e.id }}">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            {% endfor %}

            {% if entries|length == 0 %}
                <tr>
                    <td colspan="5" class="text-center text-muted">
                        No entries found
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/static/service-worker.js")
    .then(() => console.log("Service Worker Registered"))
    .catch(err => console.log("SW Error", err));
}
</script>

</body>
</html>
